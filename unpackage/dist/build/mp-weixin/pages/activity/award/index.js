(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/award/index"],{"2ca4":function(t,n,e){"use strict";e.r(n);var r=e("a749"),a=e.n(r);for(var i in r)"default"!==i&&function(t){e.d(n,t,(function(){return r[t]}))}(i);n["default"]=a.a},"2f88":function(t,n,e){},"35a6":function(t,n,e){"use strict";e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return i})),e.d(n,"a",(function(){return r}));var r={uniNavBar:function(){return e.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(e.bind(null,"35c2"))},uniIcons:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(e.bind(null,"9a3b"))}},a=function(){var t=this,n=t.$createElement,e=(t._self._c,t.activityExplain.replace(/\r\n|\n/g,"<br/>"));t._isMounted||(t.e0=function(n){return t.$router.go(-1)}),t.$mp.data=Object.assign({},{$root:{g0:e}})},i=[]},5959:function(t,n,e){"use strict";e.r(n);var r=e("35a6"),a=e("2ca4");for(var i in a)"default"!==i&&function(t){e.d(n,t,(function(){return a[t]}))}(i);e("a64b");var o,c=e("f0c5"),u=Object(c["a"])(a["default"],r["b"],r["c"],!1,null,"cbb7afce",null,!1,r["a"],o);n["default"]=u.exports},"7d0e":function(t,n,e){"use strict";(function(t){e("f38a");r(e("66fd"));var n=r(e("5959"));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(n.default)}).call(this,e("543d")["createPage"])},a64b:function(t,n,e){"use strict";var r=e("2f88"),a=e.n(r);a.a},a749:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=c(e("a34a")),a=c(e("2920")),i=e("26cb"),o=e("beeb");function c(t){return t&&t.__esModule?t:{default:t}}function u(t,n,e,r,a,i,o){try{var c=t[i](o),u=c.value}catch(s){return void e(s)}c.done?n(u):Promise.resolve(u).then(r,a)}function s(t){return function(){var n=this,e=arguments;return new Promise((function(r,a){var i=t.apply(n,e);function o(t){u(i,r,a,o,c,"next",t)}function c(t){u(i,r,a,o,c,"throw",t)}o(void 0)}))}}function f(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function d(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?f(Object(e),!0).forEach((function(n){l(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function l(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var h={data:function(){return{baseUrl:a.default.baseUrl,id:"",infoData:{},awardList:[],run:!1,activeIndex:0,activeMessage:"",rotateAngle:0,width:500,config:{duration:8e3,mode:"ease-in-out",circle:12}}},computed:d(d({},(0,i.mapGetters)(["userInfo"])),{},{title:function(){return this.infoData.title||"转盘抽奖"},residueNum:function(){var t=+this.infoData.chance_num;return t>0?t:0},activityExplain:function(){return this.infoData.explain||""},len:function(){return this.awardList.length||0},rotateDeg:function(){return this.len?360/this.len:0},rotateStyle:function(){var t=this.config;return"\n            -webkit-transition: transform ".concat(t.duration,"ms ").concat(t.mode,";\n            transition: transform ").concat(t.duration,"ms ").concat(t.mode,";\n            -webkit-transform: rotate(").concat(this.rotateAngle,"deg);\n                transform: rotate(").concat(this.rotateAngle,"deg);")},allRotateStyle:function(){return"".concat(this.run?this.rotateStyle:"")},isHaveImage:function(){return this.awardList.some((function(t){return t.img}))},noImageTextStyle:function(){var t=this.width/2,n=this.rotateDeg/2,e=90-n,r=Math.sin(2*Math.PI/360*e),a=Math.sin(2*Math.PI/360*n),i=Math.sin(2*Math.PI/360*90),o=a*(t/i),c=2*o,u=24;function s(t){return t/r*i}var f=(c*Math.cos(2*Math.PI/360*n)+t*a-c)/2;f=s(f);var d=r*(t/i);d=s(t-d);var l=a*(d/i);l=f+l,l=Math.ceil(l),l=l%2+l,d=Math.ceil(d),d=d%2+d;var h="transform: translateX(-".concat(l,"rpx) translateY(").concat(d,"rpx) rotate(").concat(n,"deg);");if(this.isHaveImage)return"".concat(h,"width: ").concat(c,"rpx;");var v=(c-u)/2;return"".concat(h,"width: ").concat(c,"rpx;padding: 0 ").concat(v,"rpx;height: ").concat(t,"rpx;")}}),onLoad:function(t){var n=t.id;n&&(this.id=n)},onShow:function(){this.getAwardInfo()},methods:{getAwardInfo:function(){var n=this;return s(r.default.mark((function e(){var a,i,c;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.getAwardInfo)({project_id:n.id});case 2:a=e.sent,i=a.data,c=a.award_list,1===+i.state||n.id?(n.infoData=i,n.awardList=c||[]):t.showModal({content:"活动已结束",showCancel:!1,confirmText:"知道了",success:function(t){t.confirm&&n.$router.go(-1)}});case 6:case"end":return e.stop()}}),e)})))()},handlePlay:function(){var n=this;+this.rotateAngle>0||this.id||(+this.infoData.chance_num<1?t.showModal({content:"您今天已经没有抽奖机会了明天再来吧",showCancel:!1,confirmText:"知道了",success:function(t){t.confirm}}):!+this.infoData.consume||+this.infoData.remaining_free>0?this.startPlay():t.showModal({content:"使用".concat(this.infoData.consume,"幸福币抽奖"),success:function(t){var e=t.confirm;e&&n.startPlay()}}))},startPlay:function(){var t=this;return s(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.luckDraw();case 2:t.run=!0,t.rotateAngle=360*t.config.circle-(t.activeIndex*t.rotateDeg+t.rotateDeg/2);case 4:case"end":return n.stop()}}),n)})))()},luckDraw:function(){var n=this;return s(r.default.mark((function e(){var a,i,c,u;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.luckDraw)().catch((function(n){var e=n.message;t.showModal({content:e,showCancel:!1,confirmText:"知道了"})}));case 2:a=e.sent,i=a.award_id,c=a.message,u=n.awardList.findIndex((function(t){return t.id==i})),n.activeIndex=u,n.activeMessage=c;case 8:case"end":return e.stop()}}),e)})))()},finishRotate:function(){var n=this;return s(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.showModal({content:n.activeMessage,showCancel:!1,success:function(t){n.run=!1,n.rotateAngle=0,n.getAwardInfo()}});case 1:case"end":return e.stop()}}),e)})))()},goCredit:function(){this.$router.push({path:"/pages/credit/creditRecord"})},goRecord:function(){this.$router.push({path:"/pages/activity/award/record"})}}};n.default=h}).call(this,e("543d")["default"])}},[["7d0e","common/runtime","common/vendor"]]]);