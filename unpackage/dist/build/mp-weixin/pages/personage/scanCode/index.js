(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/personage/scanCode/index"],{"474e":function(e,t,n){"use strict";n.r(t);var a=n("627f"),o=n("873f");for(var c in o)"default"!==c&&function(e){n.d(t,e,(function(){return o[e]}))}(c);n("bfb3");var r,i=n("f0c5"),u=Object(i["a"])(o["default"],a["b"],a["c"],!1,null,"3a0d43ae",null,!1,a["a"],r);t["default"]=u.exports},"627f":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return a}));var a={uniNavBar:function(){return n.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"35c2"))}},o=function(){var e=this,t=e.$createElement;e._self._c},c=[]},"86e7":function(e,t,n){},"873f":function(e,t,n){"use strict";n.r(t);var a=n("f62d"),o=n.n(a);for(var c in a)"default"!==c&&function(e){n.d(t,e,(function(){return a[e]}))}(c);t["default"]=o.a},bfb3:function(e,t,n){"use strict";var a=n("86e7"),o=n.n(a);o.a},e868:function(e,t,n){"use strict";(function(e){n("f38a");a(n("66fd"));var t=a(n("474e"));function a(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},f62d:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("26cb"),o=n("c92a"),c=n("ec93");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s={data:function(){return{codeId:"",current:0,tabs:[{value:1,name:"扫一扫"},{value:2,name:"付款码"},{value:3,name:"收款码"}],paymentCodeImg:"",collectCodeImg:"",timer:null}},computed:i(i({},(0,a.mapGetters)(["userInfo"])),{},{shopId:function(){return this.userInfo.shops_id}}),onLoad:function(e){this.current=parseInt(e.current)||1},onUnload:function(){this.timer&&clearTimeout(this.timer)},methods:{switchTab:function(e){this.current=e,this.timer&&clearTimeout(this.timer)},scanCode:function(){var t=this;e.scanCode({onlyFromCamera:!0,success:function(e){var n=e.result;n&&t.scanSuccess(n)}})},scanSuccess:function(e){var t=e.split("|");switch(t[0]){case"shoukuan":this.collectScan(e,t);break;case"fukuan":this.paymentScan(e,t);break;default:break}},getPaymentCode:function(){var e=this;(0,o.getPaymentCode)().then((function(t){var n=t.data,a=n.url,o=n.code_id;e.paymentCodeImg=a,e.codeId=o,e.pollingPayment()}))},getCollectCode:function(){var e=this;(0,o.getCollectCode)().then((function(t){var n=t.data,a=n.url,o=n.old_code_id;e.collectCodeImg=a,e.codeId=o,e.pollingCollect()}))},pollingPayment:function(){var e=this;2===this.current&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.paymentStatus()}),3e3))},pollingCollect:function(){var e=this;3===this.current&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.collectStatus()}),3e3))},paymentStatus:function(){var t=this;(0,o.paymentStatus)({code_id:this.codeId}).then((function(n){var a=n.data,o=a.is_pay,c=a.credits,r=a.avatar,i=a.realname,u=a.mobile,s=a.remarks;"1"!=o?c&&"0"!=c?t.$router.push({path:"/pages/credit/payment",query:{type:"3",value:t.codeId,avatar:r,realname:i,mobile:u,credits:c,remarks:s}}):t.pollingPayment():e.showModal({title:"支付成功",showCancel:!1})}))},collectStatus:function(){var t=this;(0,o.collectStatus)({old_code_id:this.codeId}).then((function(n){var a=n.data;a&&"1"==a.is_pay?e.showModal({content:"获得".concat(a.credits,"幸福币"),showCancel:!1,success:function(e){e.confirm&&t.getCollectCode()}}):t.pollingCollect()}))},collectScan:function(t,n){var a=this;(0,o.collectScan)({code_info:t}).then((function(e){var t=e.data,n=t.check_status,o=(t.is_pay,t.avatar),c=t.realname,r=t.mobile,i=t.code_id;n&&a.$router.push({path:"/pages/credit/payment",query:{type:"1",value:i,avatar:o,realname:c,mobile:r}})})).catch((function(t){e.showModal({title:t.message,showCancel:!1})}))},paymentScan:function(t,n){var a=this;(0,o.paymentScan)({code_info:t}).then((function(t){var o=t.data,c=o.check_status,r=o.is_pay,i=o.avatar,u=o.realname,s=o.mobile;c?0==r?a.$router.push({path:"/pages/credit/payment",query:{type:"2",value:n[1],avatar:i,realname:u,mobile:s}}):e.showToast({title:"对方已付款",icon:"none",duration:2e3}):e.showToast({title:"扫码失败，二维码可能过期",icon:"none",duration:2e3})})).catch((function(t){e.showModal({title:t.message,showCancel:!1})}))},goBack:function(){this.$router.go(-1)}},watch:{current:function(e){var t=this;1===e?(0,c.handlePermission)({name:"camera",title:"摄像头未开启",message:"为了提供更好服务，需要您摄像头"}).then((function(){t.scanCode()})):2===e?this.getPaymentCode():3===e&&this.getCollectCode()}}};t.default=s}).call(this,n("543d")["default"])}},[["e868","common/runtime","common/vendor"]]]);