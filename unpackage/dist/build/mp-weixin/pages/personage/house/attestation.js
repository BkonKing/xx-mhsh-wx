(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/personage/house/attestation"],{"14a2":function(e,t,i){"use strict";i.r(t);var n=i("258c"),o=i("c19f");for(var s in o)"default"!==s&&function(e){i.d(t,e,(function(){return o[e]}))}(s);i("7bc4");var r,u=i("f0c5"),a=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"dab731e4",null,!1,n["a"],r);t["default"]=a.exports},"258c":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return n}));var n={uniNavBar:function(){return i.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(i.bind(null,"35c2"))},uniList:function(){return i.e("uni_modules/uni-list/components/uni-list/uni-list").then(i.bind(null,"fa23"))},uniListItem:function(){return i.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(i.bind(null,"0917"))},uniCard:function(){return i.e("uni_modules/uni-card/components/uni-card/uni-card").then(i.bind(null,"28a1"))}},o=function(){var e=this,t=e.$createElement,i=(e._self._c,e._f("houseRoleText")(e.house_role));e.$mp.data=Object.assign({},{$root:{f0:i}})},s=[]},5825:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i("26cb"),o=i("c92a"),s=i("fb11"),r=i("21ff");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var h=function(){i.e("components/TfRadioBtn/index").then(function(){return resolve(i("bf16"))}.bind(null,i)).catch(i.oe)},d={name:"houseAttestation",components:{tfRadioBtn:h},data:function(){return{title:"",otherAgreement:{},type:0,mode:0,select:void 0,editMode:!1,checked:!1,agreeValue:!1,id:"",bindingId:"",house_id:"",project_id:"",building_id:"",unit_id:"",house_name:"",project_name:"",house_role:"",realname:"",mobile:"",isBinding:0,items:[{value:"1",name:"业主"},{value:"2",name:"业主成员"},{value:"3",name:"租户"},{value:"4",name:"租户成员"}],submitLoad:!1,submit:(0,r.throttle)(this.handleSubmit)}},computed:a(a({},(0,n.mapGetters)(["userInfo","currentProject"])),{},{houseName:function(){var e=this.house_name;return this.isUpdate&&!this.editMode?e:(console.log("house_name",e),e||"请选择")},showEditBtn:function(){return this.mode&&!this.editMode&&!(this.isBinding&&this.isMember&&this.isUpdate)},isMember:function(){return 0===this.type},isProprietor:function(){return 1===this.type},isAppend:function(){return 0===this.mode},isUpdate:function(){return 1===this.mode}}),onLoad:function(e){var t=e.type,i=e.mode,n=e.select;if(this.type=parseInt(t),this.mode=parseInt(i),this.select=parseInt(n),this.isMember&&this.isUpdate){var o=JSON.parse(e.info),s=o.realname,r=o.mobile,u=o.house_role,a=o.fc_info,c=o.project_id,h=o.project_name,d=o.house_id,l=o.id,m=o.is_binding;this.id=l,this.realname=s,this.mobile=r,this.house_role=u,this.house_name=h+a,console.log("onLoad:",this.house_name),this.isBinding=m,this.project_id=c||"",this.house_id=d||""}else this.isProprietor&&(this.isUpdate?(this.bindingId=e.id,this.bindingRoomInfo()):this.mobile=this.userInfo.mobile);if(this.isMember&&(this.items.shift(),this.isAppend)){var f=this.currentProject,b=f.project_id,_=f.house_id,p=f.project_name,g=f.fc_info;this.project_id=b,this.house_id=_,this.house_name=p+g}this.title=this.isProprietor?"房屋认证":this.isUpdate?"成员":"添加成员",this.getAgreement()},onShow:function(){var e=this.$store.state.tempData;if(console.log(e),e){var t=e.house_name,i=e.house_id,n=e.project_id,o=e.building_id,s=e.unit_id;this.house_name=t,this.house_id=i,this.project_id=n,this.building_id=o,this.unit_id=s,this.$store.commit("setTempData",null)}},methods:{getAgreement:function(){var e=this;(0,s.getAgreementContent)({article_type:2}).then((function(t){var i=t.data;e.otherAgreement=i}))},checkboxChange:function(e){var t=e.detail.value;this.agreeValue=!(!t||!t.length)},handleSubmit:function(){var t=this;if(+this.agreeValue||!this.isMember){var i=[{value:this.house_id,message:"请选择房屋"},{value:this.house_role,message:"请选择成员类型"},{value:this.realname,message:"请填写姓名"},{value:this.mobile,message:"请填写手机号"}];(0,r.validForm)(i).then((function(e){t.submitType()}))}else e.showToast({title:"请先阅读并同意会员协议",icon:"none"})},submitType:function(){this.isProprietor?this.roomAttest():this.isUpdate?this.updateMember():this.addMember()},addMember:function(){var t=this;(0,o.addMember)({project_id:this.project_id,house_id:this.house_id,realname:this.realname,mobile:this.mobile,house_role:this.house_role}).then((function(i){i.success?e.showModal({content:"添加成功",showCancel:!1,success:function(e){e.confirm&&t.$router.go(-1)}}):e.showToast({title:"保存失败",icon:"error"})})).catch((function(t){202===+t.code?e.showModal({content:"一个房产最多只能绑定10个人（包括业主），超过只能解除后再添加",showCancel:!1}):e.showToast({title:t.message,icon:"none",duration:2e3})}))},updateMember:function(){var t=this;(0,o.updateMember)({id:this.id,project_id:this.project_id,house_id:this.house_id,realname:this.realname,mobile:this.mobile,house_role:this.house_role}).then((function(i){i.success?(e.showToast({title:"修改成功",icon:"success"}),t.$router.go(-1)):e.showToast({title:"保存失败",icon:"error"})}))},onDelete:function(){var t=this;e.showModal({title:"是否确定删除",confirmText:"删除",success:function(e){e.confirm&&(t.isProprietor?t.unBinding():t.deleteMember())}})},roomAttest:function(){var t=this;this.submitLoad=!0;var i={house_id:this.house_id,project_id:this.project_id,building_id:this.building_id,unit_id:this.unit_id,house_name:this.house_name,realname:this.realname,mobile:this.mobile,house_role:this.house_role,is_default:this.checked?1:0};(0,o.roomAttest)(i).then((function(i){t.submitLoad=!1,i.success?(e.showToast({title:"审核成功",icon:"success"}),0==t.userInfo.user_type&&t.$store.dispatch("getMyAccount"),"1"==t.select&&t.$store.dispatch("getHouse"),setTimeout((function(){t.$router.go(-1)}),1e3)):e.showToast({title:"提交失败",icon:"error"})})).catch((function(){t.submitLoad=!1}))},bindingRoomInfo:function(){var e=this;(0,o.bindingRoomInfo)({bindingId:this.bindingId}).then((function(t){var i=t.data,n=i.realname,o=i.mobile,s=i.house_role,r=i.house_name,u=i.project_name,a=i.building_name,c=i.unit_name,h=i.house_id,d=i.project_id,l=i.building_id,m=i.unit_id,f=i.is_default;e.house_id=h,e.project_id=d,e.unit_id=m,e.building_id=l,e.realname=n,e.mobile=o,e.house_role=s,e.house_name=u+a+c+r,e.checked="1"===f}))},bindingDefault:function(t){var i=this,n=t.detail.value;this.checked=n,n&&(0,o.bindingDefault)({binding_id:this.bindingId}).then((function(t){e.showToast({title:"当前房间设置成功!",icon:"none"}),i.$store.dispatch("getHouse")}))},unBinding:function(){var t=this;(0,o.unBinding)({binding_id:this.bindingId}).then((function(i){e.showModal({content:"解绑成功！",showCancel:!1,success:function(e){e.confirm&&(t.$store.dispatch("getHouse"),t.$router.go(-1))}})}))},deleteMember:function(){var t=this;(0,o.deleteMember)({id:this.id}).then((function(i){e.showModal({content:"成员删除成功",showCancel:!1,success:function(e){e.confirm&&t.$router.go(-1)}})}))},goCheckHouse:function(){this.isUpdate&&!this.editMode||(this.isMember?this.$router.push({path:"/pages/personage/house/selectHouse",query:{mode:2,id:this.house_id}}):this.$router.push("/pages/personage/house/selectCommunity"))},goEdit:function(){this.agreeValue="1",this.editMode=!0},goAgreement:function(){this.$router.push("/pages/index/agreement?articleType=2")},goBack:function(){this.$router.go(-1)}}};t.default=d}).call(this,i("543d")["default"])},"7bc4":function(e,t,i){"use strict";var n=i("9b12"),o=i.n(n);o.a},"9b12":function(e,t,i){},c19f:function(e,t,i){"use strict";i.r(t);var n=i("5825"),o=i.n(n);for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);t["default"]=o.a},c40f:function(e,t,i){"use strict";(function(e){i("f38a");n(i("66fd"));var t=n(i("14a2"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=i,e(t.default)}).call(this,i("543d")["createPage"])}},[["c40f","common/runtime","common/vendor"]]]);