(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/credit/credit"],{2138:function(n,e,t){"use strict";t.d(e,"b",(function(){return o})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return i}));var i={uniNavBar:function(){return t.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(t.bind(null,"35c2"))}},o=function(){var n=this,e=n.$createElement;n._self._c;n._isMounted||(n.e0=function(e){n.showCouponCentre=!1})},r=[]},"260d":function(n,e,t){"use strict";var i=t("f4e0"),o=t.n(i);o.a},4918:function(n,e,t){"use strict";(function(n){t("f38a");i(t("66fd"));var e=i(t("89bf"));function i(n){return n&&n.__esModule?n:{default:n}}wx.__webpack_require_UNI_MP_PLUGIN__=t,n(e.default)}).call(this,t("543d")["createPage"])},"89bf":function(n,e,t){"use strict";t.r(e);var i=t("2138"),o=t("fdb0");for(var r in o)"default"!==r&&function(n){t.d(e,n,(function(){return o[n]}))}(r);t("fc6f"),t("260d");var s,a=t("f0c5"),c=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,"5c38d771",null,!1,i["a"],s);e["default"]=c.exports},"97f2":function(n,e,t){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=f(t("a34a")),o=t("26cb"),r=f(t("2920")),s=t("c92a"),a=t("3b74"),c=t("21ff"),u=t("ec93");function f(n){return n&&n.__esModule?n:{default:n}}function d(n,e,t,i,o,r,s){try{var a=n[r](s),c=a.value}catch(u){return void t(u)}a.done?e(c):Promise.resolve(c).then(i,o)}function l(n){return function(){var e=this,t=arguments;return new Promise((function(i,o){var r=n.apply(e,t);function s(n){d(r,i,o,s,a,"next",n)}function a(n){d(r,i,o,s,a,"throw",n)}s(void 0)}))}}function h(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function p(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?h(Object(t),!0).forEach((function(e){g(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function g(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}var b=function(){t.e("components/TfPopup/index").then(function(){return resolve(t("c209"))}.bind(null,t)).catch(t.oe)},v=function(){t.e("modules/TfCalendar/index").then(function(){return resolve(t("61ea"))}.bind(null,t)).catch(t.oe)},m=function(){t.e("modules/MobileLoginPopup/index").then(function(){return resolve(t("475e"))}.bind(null,t)).catch(t.oe)},C=function(){t.e("modules/SignInAlert/index").then(function(){return resolve(t("6a91"))}.bind(null,t)).catch(t.oe)},_=function(){t.e("pages/tabBar/credit/components/GetCouponList").then(function(){return resolve(t("7bda"))}.bind(null,t)).catch(t.oe)},y=function(){t.e("pages/tabBar/credit/components/TaskList").then(function(){return resolve(t("cd27"))}.bind(null,t)).catch(t.oe)},w=function(){t.e("pages/tabBar/credit/components/SignRuleDialog").then(function(){return resolve(t("6f48"))}.bind(null,t)).catch(t.oe)},I={components:{TfCalendar:v,SignInAlert:C,SignRuleDialog:w,GetCouponList:_,TaskList:y,TfPopup:b,MobileLoginPopup:m},data:function(){return{showCalendar:!1,signinToday:0,credits:"--",taskData:[],signLoading:!1,entranceStatus:!0,signRuleVisible:!1,sd_credits:"",ky_credits:"",signAlertVisible:!1,signMessage:"",signOwnerCredits:"",tabActive:"1",offsetTop:0,shopBannerInfo:{},showCouponCentre:!0,throttleSignIn:(0,c.throttle)(this.handleSignIn),showPayCredit:!1,activeCoupon:{},loginVisible:!1}},computed:p(p({},(0,o.mapGetters)(["userType","userInfo"])),{},{shopId:function(){return this.userInfo.shops_id},isShowBanner:function(){return+this.shopBannerInfo.z_money},bannerText:function(){var n=this.shopBannerInfo.banner_text;if(!n)return"";var e=n.split("$money$");if(e.length<2)return n;var t=e[0],i=e[1],o=this.shopBannerInfo.z_money;return"".concat(t,'<span class="shop-coupon-banner-number">').concat(o,"</span>").concat(i)},freezeCredit:function(){return+this.sd_credits},hasLogIn:function(){return this.userInfo&&this.userInfo.id}}),onLoad:function(){this.offsetTop=n.getSystemInfoSync().statusBarHeight,!this.hasLogIn&&(this.loginVisible=!0)},onShow:function(){this.init()},onHide:function(){this.loginVisible=!1},onPullDownRefresh:function(){this.init()},onShareAppMessage:function(){return{title:"美好生活 一键抵达",path:"/pages/tabBar/credit/credit",imageUrl:"".concat(r.default.baseUrl,"/library/img/wx/share.jpg")}},methods:{init:function(){this.hasLogIn&&(this.getCreditsAccount(),this.getShopCouponBanner(),this.$refs.getCouponList&&this.$refs.getCouponList.init())},getCreditsAccount:function(){var n=this;(0,s.getCreditsAccount)().then((function(e){var t=e.data;n.signinToday=t.signin_status,n.taskData=t.task_list,n.credits=t.credits,n.entranceStatus=!!+t.mj_status,n.ky_credits=t.ky_credits,n.sd_credits=t.sd_credits}))},getShopCouponBanner:function(){var n=this;return l(i.default.mark((function e(){var t,o;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,a.getShopCouponBanner)({shops_id:n.shopId});case 2:t=e.sent,o=t.data,n.shopBannerInfo=o||{},+n.shopBannerInfo.z_money||(n.tabActive="2");case 6:case"end":return e.stop()}}),e)})))()},handleSignIn:function(){this.hasLogIn?1===this.signinToday?this.showCalendar=!0:2===this.signinToday?this.signRuleVisible=!0:this.signin():this.$router.push("/pages/index/login")},signin:function(){var e=this;(0,u.handlePermission)({name:"userLocation",title:"定位服务未开启",message:"为了提供更好服务，需要您开启定位"}).then((function(){e.signLoading=!0,(0,s.signin)().then((function(t){e.signLoading=!1,+t.open_box?(e.signMessage=t.message,e.signOwnerCredits=t.owner_credits,e.signAlertVisible=!0):n.showToast({title:t.message,icon:"none"}),e.getCreditsAccount()})).catch((function(){e.signLoading=!1}))}))},openCreditPay:function(n){this.activeCoupon=n},receiveCoupon:function(){this.$refs.getCouponList&&this.$refs.getCouponList.receiveCoupon()},goScanCode:function(n){this.$router.push({path:"/pages/personage/scanCode/index",query:{current:n}})},goCreditRecord:function(){this.$router.push("/pages/credit/creditRecord")},onTabChange:function(n){this.tabActive=n.detail.name},openCouponCentre:function(){this.tabActive="1",this.$nextTick((function(){n.pageScrollTo({selector:".credit-tabs",duration:300})}))}}};e.default=I}).call(this,t("543d")["default"])},c4db:function(n,e,t){},f4e0:function(n,e,t){},fc6f:function(n,e,t){"use strict";var i=t("c4db"),o=t.n(i);o.a},fdb0:function(n,e,t){"use strict";t.r(e);var i=t("97f2"),o=t.n(i);for(var r in i)"default"!==r&&function(n){t.d(e,n,(function(){return i[n]}))}(r);e["default"]=o.a}},[["4918","common/runtime","common/vendor"]]]);