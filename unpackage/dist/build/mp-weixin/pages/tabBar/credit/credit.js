(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/credit/credit"],{"10a4":function(n,t,e){},"260d":function(n,t,e){"use strict";var i=e("f4e0"),o=e.n(i);o.a},4918:function(n,t,e){"use strict";(function(n){e("f38a");i(e("66fd"));var t=i(e("89bf"));function i(n){return n&&n.__esModule?n:{default:n}}wx.__webpack_require_UNI_MP_PLUGIN__=e,n(t.default)}).call(this,e("543d")["createPage"])},"69cd":function(n,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return r})),e.d(t,"a",(function(){return i}));var i={uniNavBar:function(){return e.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(e.bind(null,"35c2"))}},o=function(){var n=this,t=n.$createElement;n._self._c;n._isMounted||(n.e0=function(t){n.showCouponCentre=!1})},r=[]},"89bf":function(n,t,e){"use strict";e.r(t);var i=e("69cd"),o=e("fdb0");for(var r in o)"default"!==r&&function(n){e.d(t,n,(function(){return o[n]}))}(r);e("cfb6"),e("260d");var s,a=e("f0c5"),c=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,"3478766d",null,!1,i["a"],s);t["default"]=c.exports},"97f2":function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=u(e("a34a")),o=e("26cb"),r=e("c92a"),s=e("3b74"),a=e("21ff"),c=e("ec93");function u(n){return n&&n.__esModule?n:{default:n}}function f(n,t,e,i,o,r,s){try{var a=n[r](s),c=a.value}catch(u){return void e(u)}a.done?t(c):Promise.resolve(c).then(i,o)}function d(n){return function(){var t=this,e=arguments;return new Promise((function(i,o){var r=n.apply(t,e);function s(n){f(r,i,o,s,a,"next",n)}function a(n){f(r,i,o,s,a,"throw",n)}s(void 0)}))}}function l(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,i)}return e}function h(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?l(Object(e),!0).forEach((function(t){p(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function p(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var g=function(){e.e("modules/TfCalendar/index").then(function(){return resolve(e("61ea"))}.bind(null,e)).catch(e.oe)},b=function(){e.e("pages/tabBar/credit/components/GetCouponList").then(function(){return resolve(e("7bda"))}.bind(null,e)).catch(e.oe)},v=function(){e.e("pages/tabBar/credit/components/TaskList").then(function(){return resolve(e("cd27"))}.bind(null,e)).catch(e.oe)},m=function(){e.e("modules/SignInAlert/index").then(function(){return resolve(e("6a91"))}.bind(null,e)).catch(e.oe)},_=function(){e.e("pages/tabBar/credit/components/SignRuleDialog").then(function(){return resolve(e("6f48"))}.bind(null,e)).catch(e.oe)},y={components:{TfCalendar:g,SignInAlert:m,SignRuleDialog:_,GetCouponList:b,TaskList:v},data:function(){return{showCalendar:!1,signinToday:0,credits:"--",taskData:[],signLoading:!1,entranceStatus:!0,signRuleVisible:!1,sd_credits:"",ky_credits:"",signAlertVisible:!1,signMessage:"",signOwnerCredits:"",tabActive:"1",offsetTop:0,shopBannerInfo:{},showCouponCentre:!0,throttleSignIn:(0,a.throttle)(this.handleSignIn)}},computed:h(h({},(0,o.mapGetters)(["userType","userInfo"])),{},{shopId:function(){return this.userInfo.shops_id},isShowBanner:function(){return+this.shopBannerInfo.z_money},bannerText:function(){var n=this.shopBannerInfo.banner_text;if(!n)return"";var t=n.split("$money$");if(t.length<2)return n;var e=t[0],i=t[1],o=this.shopBannerInfo.z_money;return"".concat(e,'<span class="shop-coupon-banner-number">').concat(o,"</span>").concat(i)},freezeCredit:function(){return+this.sd_credits},hasLogIn:function(){return this.userInfo&&this.userInfo.id}}),onLoad:function(){this.offsetTop=n.getSystemInfoSync().statusBarHeight},onShow:function(){this.init()},onPullDownRefresh:function(){this.init()},methods:{init:function(){this.hasLogIn&&(this.getCreditsAccount(),this.getShopCouponBanner(),this.$refs.getCouponList&&this.$refs.getCouponList.init())},getCreditsAccount:function(){var n=this;(0,r.getCreditsAccount)().then((function(t){var e=t.data;n.signinToday=e.signin_status,n.taskData=e.task_list,n.credits=e.credits,n.entranceStatus=!!+e.mj_status,n.ky_credits=e.ky_credits,n.sd_credits=e.sd_credits}))},getShopCouponBanner:function(){var n=this;return d(i.default.mark((function t(){var e,o;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,s.getShopCouponBanner)({shops_id:n.shopId});case 2:e=t.sent,o=e.data,n.shopBannerInfo=o||{},+n.shopBannerInfo.z_money||(n.tabActive="2");case 6:case"end":return t.stop()}}),t)})))()},handleSignIn:function(){this.hasLogIn?1===this.signinToday?this.showCalendar=!0:2===this.signinToday?this.signRuleVisible=!0:this.signin():this.$router.push("/pages/index/login")},signin:function(){var t=this;(0,c.handlePermission)({name:"userLocation",title:"定位服务未开启",message:"为了提供更好服务，需要您开启定位"}).then((function(){t.signLoading=!0,(0,r.signin)().then((function(e){t.signLoading=!1,+e.open_box?(t.signMessage=e.message,t.signOwnerCredits=e.owner_credits,t.signAlertVisible=!0):n.showToast({title:e.message,icon:"none"}),t.getCreditsAccount()})).catch((function(){t.signLoading=!1}))}))},goScanCode:function(n){this.$router.push({path:"/pages/personage/scanCode/index",query:{current:n}})},goCreditRecord:function(){this.$router.push("/pages/credit/creditRecord")},onTabChange:function(n){this.tabActive=n.detail.name},openCouponCentre:function(){this.tabActive="1",this.$nextTick((function(){n.pageScrollTo({selector:".credit-tabs",duration:300})}))}}};t.default=y}).call(this,e("543d")["default"])},cfb6:function(n,t,e){"use strict";var i=e("10a4"),o=e.n(i);o.a},f4e0:function(n,t,e){},fdb0:function(n,t,e){"use strict";e.r(t);var i=e("97f2"),o=e.n(i);for(var r in i)"default"!==r&&function(n){e.d(t,n,(function(){return i[n]}))}(r);t["default"]=o.a}},[["4918","common/runtime","common/vendor"]]]);